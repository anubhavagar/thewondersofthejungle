server {
    listen 80;
    server_name localhost;

    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Proxy API requests to the backend container
    location /api {
        proxy_pass http://backend:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        # Remove /api prefix when forwarding to backend if needed
        # In our case, the backend handles /auth, /analyze etc.
        # But wait, looking at api/main.py, it doesn't have an /api prefix for the router.
        # It includes api_router directly.
        # If frontend calls /api/history, Nginx should proxy to backend:8000/history? or backend:8000/api/history?
        # Let's check api/main.py and api/routes/endpoints.py
        # app.include_router(api_router)
        # router = APIRouter()
        # So the routes are /, /auth, /history etc.
        # So we NEED to rewrite /api/ to /
        rewrite ^/api/(.*) /$1 break;
    }

    # Proxy uploads
    location /uploads {
        proxy_pass http://backend:8000/uploads;
    }
}
